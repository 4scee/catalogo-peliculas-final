<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <!-- Header -->
      <div class="d-flex align-items-center mb-4">
        <button class="btn btn-outline-secondary me-3" (click)="onCancel()" [disabled]="isLoading">
          <i class="bi bi-arrow-left"></i>
        </button>
        <h1 class="h3 mb-0 text-primary">
          <i class="bi bi-plus-circle me-2"></i>Agregar Nueva Película
        </h1>
      </div>

      <!-- Alertas -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
      </div>

      <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        {{ successMessage }}
        <button type="button" class="btn-close" (click)="successMessage = ''"></button>
      </div>

      <div class="card shadow">
        <div class="card-body">
          <div class="row">
            <!-- Formulario -->
            <div class="col-md-6">
              <form (ngSubmit)="onSubmit()" #peliculaForm="ngForm">
                <!-- Campo Nombre -->
                <div class="mb-3">
                  <label for="nombre" class="form-label">Nombre de la Película <span class="text-danger">*</span></label>
                  <input
                    type="text"
                    class="form-control"
                    id="nombre"
                    name="nombre"
                    [(ngModel)]="pelicula.nombre"
                    required
                    minlength="2"
                    maxlength="255"
                    placeholder="Ej: El Padrino"
                    [class.is-invalid]="errorMessage && !pelicula.nombre"
                  >
                  <div class="form-text">Mínimo 2 caracteres, máximo 255</div>
                </div>

                <!-- Campo Año -->
                <div class="mb-3">
                  <label for="anio" class="form-label">Año de Estreno <span class="text-danger">*</span></label>
                  <input
                    type="number"
                    class="form-control"
                    id="anio"
                    name="anio"
                    [(ngModel)]="pelicula.anio"
                    required
                    min="1900"
                    [max]="maxYear"
                    placeholder="Ej: 2023"
                    [class.is-invalid]="errorMessage && (!pelicula.anio || pelicula.anio < 1900)"
                  >
                  <div class="form-text">Entre 1900 y {{ maxYear }}</div>
                </div>

                <!-- Campo Imagen -->
                <div class="mb-3">
                  <label for="imagen" class="form-label">URL de la Imagen <span class="text-danger">*</span></label>
                  <input
                    type="url"
                    class="form-control"
                    id="imagen"
                    name="imagen"
                    [(ngModel)]="pelicula.imagen"
                    required
                    placeholder="https://ejemplo.com/poster.jpg"
                    [class.is-invalid]="errorMessage && !pelicula.imagen"
                  >
                  <div class="form-text">URL válida de la imagen (http:// o https://)</div>
                </div>

                <!-- Campo Sinopsis -->
                <div class="mb-4">
                  <label for="sinopsis" class="form-label">Sinopsis <span class="text-danger">*</span></label>
                  <textarea
                    class="form-control"
                    id="sinopsis"
                    name="sinopsis"
                    [(ngModel)]="pelicula.sinopsis"
                    required
                    rows="5"
                    minlength="10"
                    maxlength="1000"
                    placeholder="Describe la trama de la película..."
                    [class.is-invalid]="errorMessage && !pelicula.sinopsis"
                  ></textarea>
                  <div class="form-text">Mínimo 10 caracteres, máximo 1000</div>
                </div>

                <!-- Botones -->
                <div class="d-grid gap-2 d-md-flex">
                  <button
                    type="button"
                    class="btn btn-outline-secondary flex-fill"
                    (click)="onCancel()"
                    [disabled]="isLoading"
                  >
                    <i class="bi bi-x-circle me-2"></i>Cancelar
                  </button>
                  
                  <button
                    type="submit"
                    class="btn btn-primary flex-fill"
                    [disabled]="peliculaForm.invalid || isLoading"
                  >
                    <span *ngIf="!isLoading">
                      <i class="bi bi-plus-circle me-2"></i>Agregar Película
                    </span>
                    <span *ngIf="isLoading">
                      <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                      Guardando...
                    </span>
                  </button>
                </div>
              </form>
            </div>

            <!-- Vista Previa -->
            <div class="col-md-6">
              <div class="sticky-top" style="top: 20px;">
                <h5 class="text-center mb-3 text-muted">
                  <i class="bi bi-eye me-2"></i>Vista Previa
                </h5>
                
                <!-- Tarjeta de Vista Previa -->
                <div class="card mb-4">
                  <img 
                    [src]="imagePreview" 
                    class="card-img-top" 
                    alt="Vista previa"
                    style="height: 300px; object-fit: cover;"
                    onerror="this.src='https://via.placeholder.com/400x300?text=Imagen+no+disponible'"
                  >
                  <div class="card-body">
                    <h6 class="card-title">{{ pelicula.nombre || 'Nombre de la Película' }}</h6>
                    <p class="card-text text-muted small mb-2">
                      <strong>Año:</strong> {{ pelicula.anio || '----' }}
                    </p>
                    <p class="card-text small">
                      {{ (pelicula.sinopsis || 'La sinopsis aparecerá aquí...') | slice:0:120 }}{{ pelicula.sinopsis && pelicula.sinopsis.length > 120 ? '...' : '' }}
                    </p>
                  </div>
                </div>

                <!-- Información de Validación -->
                <div class="alert alert-info">
                  <h6 class="alert-heading mb-2">
                    <i class="bi bi-info-circle me-2"></i>Información Importante
                  </h6>
                  <ul class="mb-0 small">
                    <li>Todos los campos son obligatorios</li>
                    <li>La imagen debe ser una URL válida</li>
                    <li>El año debe ser entre 1900-{{ maxYear }}</li>
                    <li>La sinopsis debe tener al menos 10 caracteres</li>
                  </ul>
                </div>

                <!-- Estado del Formulario -->
                <div class="card bg-light">
                  <div class="card-body">
                    <h6 class="card-title">
                      <i class="bi bi-clipboard-check me-2"></i>Estado del Formulario
                    </h6>
                    <div class="small">
                      <div>Nombre: {{ pelicula.nombre ? '✓' : '✗' }} ({{ pelicula.nombre.length }}/255)</div>
                      <div>Año: {{ pelicula.anio ? '✓' : '✗' }}</div>
                      <div>Imagen: {{ pelicula.imagen ? '✓' : '✗' }}</div>
                      <div>Sinopsis: {{ pelicula.sinopsis ? '✓' : '✗' }} ({{ pelicula.sinopsis.length }}/1000)</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>